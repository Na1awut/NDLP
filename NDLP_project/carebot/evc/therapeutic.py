"""
EVC Therapeutic ‚Äî Therapeutic bias and emotional recovery guidance

Therapeutic Bias:
  ‡πÄ‡∏°‡∏∑‡πà‡∏≠ E < 0 ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏° S ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏î‡∏±‡∏ô‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏Ç‡∏∂‡πâ‡∏ô
  S' = S + Œ≤_T √ó |E| √ó ùüô[E < 0]
  Œ≤_T = 0.05
"""

THERAPEUTIC_BIAS = 0.05  # Strength of positive push


def apply_therapeutic_bias(S: float, E_current: float) -> float:
    """
    ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏î‡∏±‡∏ô‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏ã‡∏ô‡∏•‡∏ö
    ‡∏¢‡∏¥‡πà‡∏á E ‡∏•‡∏ö‡∏°‡∏≤‡∏Å ‚Üí ‡∏î‡∏±‡∏ô‡∏¢‡∏¥‡πà‡∏á‡πÅ‡∏£‡∏á (‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ)
    """
    if E_current < 0:
        bias = THERAPEUTIC_BIAS * abs(E_current)
        return S + bias
    return S


def get_therapeutic_note(E: float, delta_E: float, turn: int) -> str:
    """
    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ä‡∏¥‡∏á‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö EVC Result

    ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LLM ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô policy
    """
    notes: list[str] = []

    # ‚îÄ‚îÄ‚îÄ‚îÄ Recovery tracking ‚îÄ‚îÄ‚îÄ‚îÄ
    if E < -4 and delta_E > 0:
        notes.append(
            "‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏∑‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏à‡∏≤‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏•‡∏ö ‚Äî "
            "‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏°‡πÄ‡∏ö‡∏≤‡πÜ ‡∏ß‡πà‡∏≤ '‡∏î‡∏µ‡πÉ‡∏à‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á'"
        )

    # ‚îÄ‚îÄ‚îÄ‚îÄ Prolonged negative ‚îÄ‚îÄ‚îÄ‚îÄ
    if E < -3 and turn > 5:
        notes.append(
            "‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏•‡∏ö‡∏ô‡∏≤‡∏ô ‚Äî "
            "‡∏•‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ß‡πâ‡πÉ‡∏à"
        )

    # ‚îÄ‚îÄ‚îÄ‚îÄ Stable positive ‚îÄ‚îÄ‚îÄ‚îÄ
    if 2 < E < 6 and abs(delta_E) < 0.5:
        notes.append(
            "‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏î‡∏µ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà ‚Äî "
            "‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≥"
        )

    # ‚îÄ‚îÄ‚îÄ‚îÄ First interaction ‚îÄ‚îÄ‚îÄ‚îÄ
    if turn <= 1:
        notes.append(
            "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤ ‚Äî "
            "‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏±‡∏ß ‡∏ñ‡∏≤‡∏°‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏ö‡πâ‡∏≤‡∏á"
        )

    # ‚îÄ‚îÄ‚îÄ‚îÄ Overheat positive ‚îÄ‚îÄ‚îÄ‚îÄ
    if E > 6:
        notes.append(
            "‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô‡∏°‡∏≤‡∏Å ‚Äî "
            "‡∏£‡πà‡∏ß‡∏°‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡πÅ‡∏ï‡πà‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏î‡∏∏‡∏• ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏Ç‡∏ì‡∏∞‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏û‡∏•‡∏∏‡πà‡∏á‡∏û‡∏•‡πà‡∏≤‡∏ô"
        )

    if not notes:
        return ""

    return " | ".join(notes)
